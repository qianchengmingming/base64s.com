<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>File to Base64 Converter | Any File Format Base64 Encoder - Base64s.com</title>
    <link rel="icon" href="/static/images/logo.svg" type="image/png">
    <meta name="keywords" content="File to Base64,Base64 File Encoder,PDF to Base64,Document to Base64,Any File Converter,File Embedding,Data URI Generator">
    <meta name="description" content="Convert any file to Base64 online. Support all file formats up to 50MB. Multiple output formats: plain text, data URI, JSON, XML. Perfect for file embedding and storage.">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- 导航栏样式 -->
    <link rel="stylesheet" href="/static/css/navbar.css">
</head>

<body>
    <!-- 导航栏容器 - 将由JavaScript动态加载 -->
    <div id="navbar-container"></div>

    <!-- 第2栏：介绍栏 -->
    <div class="container intro-section" style="margin-top: 10px; margin-bottom: 20px;">
        <div class="d-flex align-items-center justify-content-start">
            <h1 class="me-4" style="margin: 0; font-size: 1.2rem; font-weight: 600;" data-file="title">文件Base64编码工具</h1>
            <h2 class="mb-0" style="font-size: 1rem; color: #6c757d; font-weight: 400;" data-file="subtitle">支持任意文件转Base64编码，最大50MB，多种输出格式</h2>
        </div>
    </div>

    <!-- 第3栏：主要内容区 -->
    <div class="container text-center" style="margin-top: 10px; margin-bottom: 10px;">
        <div class="row textarea-container">
            <!-- 左侧：文件上传/显示区域 -->
            <div class="col input-section">
                <p class="fw-lighter text-start" data-file="uploadLabel">请选择文件进行编码或查看Base64解码后的文件：</p>
                <div class="position-relative">
                    <!-- 文件上传区域 -->
                    <div id="uploadArea" class="file-display-area">
                        <div class="upload-content">
                            <i class="bi bi-file-earmark-arrow-up display-4 text-muted"></i>
                            <p class="mt-2 mb-2" data-file="dragDropText">拖拽文件到此处或点击选择</p>
                            <p class="text-muted small" data-file="supportedFormats">支持任意文件格式（最大50MB）</p>
                            <input type="file" id="fileInput" style="display: none;">
                            <button type="button" class="btn btn-primary btn-sm" onclick="selectFile()" data-file="uploadBtn">选择文件</button>
                        </div>
                    </div>
                    
                    <!-- 文件信息显示区域 -->
                    <div id="fileDisplay" class="file-display-area" style="display: none;">
                        <div class="file-preview">
                            <i id="fileIcon" class="bi bi-file-earmark display-2 text-primary mb-3"></i>
                            <h6 id="fileName" class="mb-2"></h6>
                            <div class="file-details">
                                <p class="mb-1"><span class="text-muted">大小：</span><span id="fileSize"></span></p>
                                <p class="mb-0"><span class="text-muted">类型：</span><span id="fileType"></span></p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 文件下载显示区域 -->
                    <div id="fileDownloadDisplay" class="file-display-area" style="display: none;">
                        <div class="file-download-content text-center">
                            <i class="bi bi-file-earmark-arrow-down display-2 text-success mb-3"></i>
                            <h5 class="mb-3">文件解析成功！</h5>
                            <div class="file-info mb-3">
                                <h6 id="parsedFileName" class="mb-2 text-primary"></h6>
                                <p id="parsedFileInfo" class="text-muted small mb-1"></p>
                                <p id="parsedFileSizeInfo" class="text-muted small"></p>
                            </div>
                            <div class="download-buttons">
                                <button type="button" class="btn btn-success btn-lg" onclick="downloadParsedFile()">
                                    <i class="bi bi-download"></i>
                                    <span id="downloadBtnText">下载文件</span>
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm mt-2" onclick="previewParsedFile()" id="previewBtn" style="display: none;">
                                    <i class="bi bi-eye"></i>
                                    预览文件
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 清空按钮 -->
                    <div class="position-absolute top-0 end-0 p-2">
                        <button type="button" class="btn clear-btn" style="padding:0 5px;" title="清空" onclick="clearFile()" data-main-title="clearBtn">
                            <i class="bi bi-x-lg"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 移动端操作按钮区域 -->
            <div class="col-12 mobile-buttons" style="margin: 0;padding: 0;">
                <div class="d-flex justify-content-center gap-2 my-3">
                    <button type="button" class="btn btn-primary encode-btn" onclick="fileToBase64()" style="width: 80px;">
                        <i class="bi bi-arrow-right"></i>
                        <span data-file="encodeBtn">编码</span>
                    </button>
                    <button type="button" class="btn btn-info decode-btn" style="width: 80px;" onclick="base64ToFile()">
                        <i class="bi bi-arrow-left"></i>
                        <span data-file="decodeBtn">解码</span>
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="clearAll()" style="width: 80px;">
                        <i class="bi bi-trash"></i>
                        <span data-file="clearBtn">清空</span>
                    </button>
                </div>
            </div>

            <!-- 右侧：Base64输出区域 -->
            <div class="col output-section">
                <p class="fw-lighter text-start" data-file="outputLabel">Base64编码结果或输入Base64字符串进行解码：</p>
                <div class="position-relative">
                    <textarea id="base64Text" class="code-input" placeholder="Base64编码结果将显示在这里，或输入Base64字符串进行解码..." aria-label="Base64 input/output" data-file-placeholder="base64Placeholder"></textarea>
                    <div class="position-absolute top-0 end-0 p-2">
                        <button type="button" class="btn clear-btn" style="padding:0 5px;" title="清空" onclick="clearBase64()" data-main-title="clearBtn">
                            <i class="bi bi-x-lg"></i>
                        </button>
                    </div>
                    <div class="position-absolute bottom-0 p-2" style="right: 20px;">
                        <button type="button" class="btn copy-btn" style="padding:0 5px;" title="复制" onclick="copyBase64()" data-main-title="copyBtn">
                            <i class="bi bi-clipboard"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 第4栏：桌面端操作按钮 -->
    <div class="container desktop-buttons">
        <div class="d-flex justify-content-start gap-2">
            <button type="button" class="btn btn-primary encode-btn" onclick="fileToBase64()" style="min-width: 120px;">
                <i class="bi bi-arrow-right"></i>
                <span data-file="encodeBtn">转换文件</span>
            </button>
            <button type="button" class="btn btn-outline-primary" onclick="copyBase64()">
                <i class="bi bi-clipboard"></i>
                <span data-file="copyBase64Btn">复制Base64</span>
            </button>
            <button type="button" class="btn btn-outline-primary" onclick="downloadResult()">
                <i class="bi bi-download"></i>
                <span data-file="downloadBtn">下载结果</span>
            </button>
            <button type="button" class="btn btn-outline-primary" onclick="clearAll()">
                <i class="bi bi-trash"></i>
                <span data-file="clearAllBtn">清空</span>
            </button>
        </div>
    </div>

    <!-- 第5栏：提示消息区域 -->
    <div class="container" style="margin-top: 20px;">
        <div id="alertMessage" class="alert alert-info" role="alert" style="display: none;" data-file="initialMessage">
            请选择文件开始转换。
        </div>
    </div>

    <!-- 第6栏：设置区域 -->
    <div class="container">
        <hr>
        <div class="d-flex flex-wrap gap-3 align-items-end" style="margin-bottom: 20px;">
            <!-- 输出格式设置 -->
            <div class="flex-shrink-0" style="min-width: 250px;">
                <label class="form-label small" data-file="outputFormatLabel">输出格式</label>
                <select class="form-select" id="outputFormat">
                    <option value="plaintext" data-file="formatPlainText">纯文本 Base64</option>
                    <option value="datauri" data-file="formatDataURI">Data URI</option>
                    <option value="htmllink" data-file="formatHtmlLink">HTML 超链接</option>
                    <option value="json" data-file="formatJSON">JSON 格式</option>
                    <option value="xml" data-file="formatXML">XML 格式</option>
                </select>
            </div>

            <!-- 自动复制开关 -->
            <div class="flex-shrink-0">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="autoCopyResult" checked>
                    <label class="form-check-label small" for="autoCopyResult" data-file="autoCopyLabel">自动复制结果</label>
                </div>
            </div>

            <!-- 记住输出格式开关 -->
            <div class="flex-shrink-0">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="rememberOutputFormat" checked>
                    <label class="form-check-label small" for="rememberOutputFormat" data-file="rememberFormatLabel">记住输出格式</label>
                </div>
            </div>

            <!-- 保存文件数据开关 -->
            <div class="flex-shrink-0">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="preserveFileData" checked>
                    <label class="form-check-label small" for="preserveFileData" data-file="preserveDataLabel">保存文件数据</label>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript引用 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <!-- 导航栏管理 -->
    <script src="/static/js/navbar.js"></script>
    <!-- 多语言支持 -->
    <script src="/static/js/languageswitch.js"></script>

    <!-- 页面专用JavaScript -->
    <script>
        // 文件转换设置
        let fileSettings = {
            autoCopyResult: true,
            rememberOutputFormat: true,
            preserveFileData: true,
            outputFormat: 'plaintext'
        };

        // 当前处理的文件信息
        let currentFile = null;
        let currentFileData = null;
        let currentBase64 = null;
        
        // 文件解析相关数据
        let parsedFileData = null;
        let parsedFileName = null;
        let parsedFileType = null;
        let parsedFileSize = null;

        // 页面加载完成后初始化
        $(document).ready(function() {
            loadFileSettings();
            initializeFileUpload();
            initializeTooltips();
            setupFileEventListeners();
            restoreFileData();

            // 确保函数在全局作用域中可用
            window.fileToBase64 = fileToBase64;
            window.base64ToFile = base64ToFile;
            window.clearFile = clearFile;
            window.clearBase64 = clearBase64;
            window.copyBase64 = copyBase64;
            window.selectFile = selectFile;
            window.clearAll = clearAll;
            window.downloadResult = downloadResult;
            window.downloadParsedFile = downloadParsedFile;
            window.previewParsedFile = previewParsedFile;
        });

        // 加载文件转换设置
        function loadFileSettings() {
            const savedSettings = localStorage.getItem('fileSettings');
            if (savedSettings) {
                try {
                    fileSettings = {...fileSettings, ...JSON.parse(savedSettings)};
                } catch (e) {
                    // 加载文件设置失败
                }
            }
            
            // 更新UI
            $('#autoCopyResult').prop('checked', fileSettings.autoCopyResult);
            $('#rememberOutputFormat').prop('checked', fileSettings.rememberOutputFormat);
            $('#preserveFileData').prop('checked', fileSettings.preserveFileData);
            $('#outputFormat').val(fileSettings.outputFormat);
        }

        // 保存文件转换设置
        function saveFileSettings() {
            fileSettings.autoCopyResult = $('#autoCopyResult').is(':checked');
            fileSettings.rememberOutputFormat = $('#rememberOutputFormat').is(':checked');
            fileSettings.preserveFileData = $('#preserveFileData').is(':checked');
            fileSettings.outputFormat = $('#outputFormat').val();
            
            localStorage.setItem('fileSettings', JSON.stringify(fileSettings));
        }

        // 初始化文件上传功能
        function initializeFileUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');

            // 拖拽事件处理
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect(files[0]);
                }
            });

            // 点击选择文件
            uploadArea.addEventListener('click', () => {
                fileInput.click();
            });

            // 文件选择变化
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileSelect(e.target.files[0]);
                }
            });
        }

        // 处理文件选择
        function handleFileSelect(file) {
            if (file.size > 50 * 1024 * 1024) { // 50MB
                showAlert('文件大小超过50MB限制。', 'danger');
                return;
            }

            currentFile = file;
            showFileInfo(file);
            
            // 自动转换（如果启用）
            if (fileSettings.autoConvert !== false) {
                setTimeout(() => {
                    fileToBase64();
                }, 100);
            }
        }

        // 显示文件信息
        function showFileInfo(file) {
            // 更新文件图标
            const fileIcon = $('#fileIcon');
            const extension = file.name.split('.').pop().toLowerCase();
            const iconClass = getFileIconClass(extension);
            fileIcon.attr('class', `bi ${iconClass} display-2 text-primary mb-3`);
            
            // 更新文件信息
            $('#fileName').text(file.name);
            $('#fileSize').text(formatFileSize(file.size));
            $('#fileType').text(file.type || '未知');
            
            // 切换显示区域
            $('#uploadArea').hide();
            $('#fileDisplay').show();
        }

        // 根据文件扩展名获取图标类
        function getFileIconClass(extension) {
            const iconMap = {
                'pdf': 'bi-file-earmark-pdf',
                'doc': 'bi-file-earmark-word',
                'docx': 'bi-file-earmark-word',
                'xls': 'bi-file-earmark-excel',
                'xlsx': 'bi-file-earmark-excel',
                'ppt': 'bi-file-earmark-ppt',
                'pptx': 'bi-file-earmark-ppt',
                'txt': 'bi-file-earmark-text',
                'jpg': 'bi-file-earmark-image',
                'jpeg': 'bi-file-earmark-image',
                'png': 'bi-file-earmark-image',
                'gif': 'bi-file-earmark-image',
                'svg': 'bi-file-earmark-image',
                'webp': 'bi-file-earmark-image',
                'zip': 'bi-file-earmark-zip',
                'rar': 'bi-file-earmark-zip',
                '7z': 'bi-file-earmark-zip',
                'mp3': 'bi-file-earmark-music',
                'wav': 'bi-file-earmark-music',
                'mp4': 'bi-file-earmark-play',
                'avi': 'bi-file-earmark-play',
                'mov': 'bi-file-earmark-play'
            };
            return iconMap[extension] || 'bi-file-earmark';
        }

        // 文件转Base64
        function fileToBase64() {
            if (!currentFile) {
                showAlert('请先选择文件。', 'warning');
                return;
            }

            showAlert('正在处理文件...', 'info');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const base64String = e.target.result.split(',')[1]; // 移除data:mime;base64,前缀
                currentBase64 = base64String;
                currentFileData = {
                    name: currentFile.name,
                    size: currentFile.size,
                    type: currentFile.type,
                    base64: base64String
                };
                
                // 保存文件数据（如果启用）
                if (fileSettings.preserveFileData) {
                    localStorage.setItem('currentFileData', JSON.stringify(currentFileData));
                }
                
                // 生成并显示结果
                generateOutput();
                
                // 自动复制（如果启用）
                if (fileSettings.autoCopyResult) {
                    copyToClipboard(document.getElementById('base64Text').value);
                    showAlert('文件已转换并复制到剪贴板！', 'success');
                } else {
                    showAlert('文件已成功转换为Base64！', 'success');
                }
            };
            
            reader.onerror = function() {
                showAlert('文件读取错误。', 'danger');
            };
            
            reader.readAsDataURL(currentFile);
        }

        // 生成输出结果
        function generateOutput() {
            if (!currentFileData) return;
            
            const selectedFormat = fileSettings.outputFormat;
            let output = '';
            
            switch (selectedFormat) {
                case 'plaintext':
                    output = currentFileData.base64;
                    break;
                case 'datauri':
                    output = `data:${currentFileData.type || 'application/octet-stream'};base64,${currentFileData.base64}`;
                    break;
                case 'htmllink':
                    const dataUri = `data:${currentFileData.type || 'application/octet-stream'};base64,${currentFileData.base64}`;
                    output = `<a href="${dataUri}" download="${currentFileData.name}">${currentFileData.name}</a>`;
                    break;
                case 'json':
                    output = JSON.stringify({
                        file: {
                            mime: currentFileData.type || 'application/octet-stream',
                            data: currentFileData.base64,
                            name: currentFileData.name,
                            size: currentFileData.size
                        }
                    }, null, 2);
                    break;
                case 'xml':
                    output = `<file mime="${currentFileData.type || 'application/octet-stream'}" name="${currentFileData.name}" size="${currentFileData.size}">${currentFileData.base64}</file>`;
                    break;
            }
            
            $('#base64Text').val(output);
        }

        // 格式化文件大小
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // 选择文件（按钮点击）
        function selectFile() {
            $('#fileInput').click();
        }

        // 清空文件
        function clearFile() {
            currentFile = null;
            currentFileData = null;
            currentBase64 = null;
            
            // 清空解析后的文件数据
            parsedFileData = null;
            parsedFileName = null;
            parsedFileType = null;
            parsedFileSize = null;
            
            $('#fileDisplay').hide();
            $('#fileDownloadDisplay').hide();
            $('#uploadArea').show();
            $('#fileInput').val('');
            
            // 清除保存的文件数据
            localStorage.removeItem('currentFileData');
        }

        // 清空Base64输入
        function clearBase64() {
            currentBase64 = null;
            $('#base64Text').val('');
        }

        // 复制Base64
        function copyBase64() {
            const base64Text = $('#base64Text').val();
            if (!base64Text) {
                showAlert('没有Base64内容可复制。', 'warning');
                return;
            }
            copyToClipboard(base64Text);
            showAlert('Base64已复制到剪贴板！', 'success');
        }

        // 下载结果
        function downloadResult() {
            const result = $('#base64Text').val();
            if (!result) {
                showAlert('没有结果可下载。', 'warning');
                return;
            }
            
            const selectedFormat = fileSettings.outputFormat;
            const fileName = currentFileData ? currentFileData.name : 'file';
            
            let downloadFileName = '';
            let mimeType = 'text/plain';
            
            switch (selectedFormat) {
                case 'plaintext':
                    downloadFileName = `${fileName}.base64.txt`;
                    break;
                case 'datauri':
                    downloadFileName = `${fileName}.datauri.txt`;
                    break;
                case 'htmllink':
                    downloadFileName = `${fileName}.html`;
                    mimeType = 'text/html';
                    break;
                case 'json':
                    downloadFileName = `${fileName}.json`;
                    mimeType = 'application/json';
                    break;
                case 'xml':
                    downloadFileName = `${fileName}.xml`;
                    mimeType = 'application/xml';
                    break;
            }
            
            const blob = new Blob([result], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = downloadFileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showAlert('结果已下载！', 'success');
        }

        // 清空所有内容
        function clearAll() {
            clearFile();
            clearBase64();
            showAlert('所有内容已清空。', 'info');
        }

        // 恢复文件数据
        function restoreFileData() {
            if (!fileSettings.preserveFileData) return;
            
            const savedData = localStorage.getItem('currentFileData');
            if (savedData) {
                try {
                    currentFileData = JSON.parse(savedData);
                    currentBase64 = currentFileData.base64;
                    
                    // 创建模拟文件对象用于显示信息
                    const mockFile = {
                        name: currentFileData.name,
                        size: currentFileData.size,
                        type: currentFileData.type
                    };
                    
                    showFileInfo(mockFile);
                    generateOutput();
                    
                } catch (e) {
                    // 恢复文件数据失败
                    localStorage.removeItem('currentFileData');
                }
            }
        }

        // 复制到剪贴板通用函数
        function copyToClipboard(text) {
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text);
            } else {
                // 降级方案
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-9999px';
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
            }
        }

        // Base64转文件
        function base64ToFile() {
            const base64Input = $('#base64Text').val().trim();
            
            if (!base64Input) {
                showAlert('请输入Base64字符串。', 'warning');
                return;
            }

            showAlert('正在解析Base64数据...', 'info');

            try {
                // 尝试解析Base64字符串
                let base64Data, mimeType, fileName;
                
                if (base64Input.startsWith('data:')) {
                    // Data URI 格式
                    const parts = base64Input.split(',');
                    if (parts.length !== 2) {
                        showAlert('无效的Data URI格式。', 'danger');
                        return;
                    }
                    
                    const header = parts[0];
                    base64Data = parts[1];
                    
                    // 提取MIME类型
                    const mimeMatch = header.match(/data:([^;]+)/);
                    mimeType = mimeMatch ? mimeMatch[1] : 'application/octet-stream';
                } else {
                    // 纯Base64字符串
                    base64Data = base64Input;
                    mimeType = 'application/octet-stream';
                }
                
                // 验证Base64格式
                if (!/^[A-Za-z0-9+/]*={0,2}$/.test(base64Data)) {
                    showAlert('无效的Base64格式。', 'danger');
                    return;
                }
                
                // 解码Base64
                const binaryString = atob(base64Data);
                const bytes = new Uint8Array(binaryString.length);
                for (let i = 0; i < binaryString.length; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }
                
                // 生成文件名
                const extension = getFileExtensionFromMimeType(mimeType);
                fileName = `decoded_file_${Date.now()}.${extension}`;
                
                // 保存解析的文件数据
                parsedFileData = bytes;
                parsedFileName = fileName;
                parsedFileType = mimeType;
                parsedFileSize = bytes.length;
                
                // 显示文件信息
                showParsedFileInfo();
                
                showAlert('Base64解析成功！', 'success');
                
            } catch (e) {
                showAlert('Base64解析失败：' + e.message, 'danger');
            }
        }

        // 显示解析后的文件信息
        function showParsedFileInfo() {
            $('#parsedFileName').text(parsedFileName);
            $('#parsedFileInfo').text(`类型：${parsedFileType || '未知'}`);
            $('#parsedFileSizeInfo').text(`大小：${formatFileSize(parsedFileSize)}`);
            $('#downloadBtnText').text(`下载 ${parsedFileName}`);
            
            // 隐藏其他显示区域
            $('#uploadArea').hide();
            $('#fileDisplay').hide();
            
            // 显示文件下载区域
            $('#fileDownloadDisplay').show();
            
            // 如果是文本文件，显示预览按钮
            if (parsedFileType && (parsedFileType.startsWith('text/') || parsedFileType.includes('json') || parsedFileType.includes('xml'))) {
                $('#previewBtn').show();
            } else {
                $('#previewBtn').hide();
            }
        }

        // 下载解析后的文件
        function downloadParsedFile() {
            if (!parsedFileData || !parsedFileName) {
                showAlert('没有可下载的文件。', 'warning');
                return;
            }
            
            try {
                // 创建Blob对象
                const blob = new Blob([parsedFileData], { type: parsedFileType });
                
                // 创建下载链接
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = parsedFileName;
                
                // 触发下载
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // 清理URL对象
                URL.revokeObjectURL(url);
                
                showAlert('文件下载已开始！', 'success');
                
            } catch (e) {
                showAlert('文件下载失败：' + e.message, 'danger');
            }
        }

        // 预览解析后的文件
        function previewParsedFile() {
            if (!parsedFileData || !parsedFileName) {
                showAlert('没有可预览的文件。', 'warning');
                return;
            }
            
            try {
                // 将字节数组转换为文本
                const text = new TextDecoder('utf-8').decode(parsedFileData);
                
                // 创建一个新的预览区域，而不是新窗口
                let previewDiv = document.getElementById('filePreviewArea');
                if (!previewDiv) {
                    previewDiv = document.createElement('div');
                    previewDiv.id = 'filePreviewArea';
                    previewDiv.className = 'card mt-3';
                    document.querySelector('.container').appendChild(previewDiv);
                }
                
                // 转义HTML字符
                const escapedText = text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                
                previewDiv.innerHTML = 
                    '<div class="card-header d-flex justify-content-between align-items-center">' +
                    '<h5 class="mb-0">文件预览</h5>' +
                    '<button type="button" class="btn btn-sm btn-outline-secondary" onclick="this.closest(\'.card\').style.display=\'none\'">关闭</button>' +
                    '</div>' +
                    '<div class="card-body">' +
                    '<div class="mb-3">' +
                    '<p><strong>文件名：</strong>' + parsedFileName + '</p>' +
                    '<p><strong>类型：</strong>' + parsedFileType + '</p>' +
                    '<p><strong>大小：</strong>' + formatFileSize(parsedFileSize) + '</p>' +
                    '</div>' +
                    '<pre style="background: #f8f9fa; padding: 15px; border-radius: 5px; max-height: 400px; overflow-y: auto; white-space: pre-wrap;">' + 
                    escapedText + 
                    '</pre>' +
                    '</div>';
                
                previewDiv.style.display = 'block';
                
            } catch (e) {
                showAlert('文件预览失败：' + e.message, 'danger');
            }
        }

        // 根据MIME类型获取文件扩展名
        function getFileExtensionFromMimeType(mimeType) {
            const mimeMap = {
                'text/plain': 'txt',
                'text/html': 'html',
                'text/css': 'css',
                'text/javascript': 'js',
                'application/json': 'json',
                'application/xml': 'xml',
                'text/xml': 'xml',
                'application/pdf': 'pdf',
                'image/jpeg': 'jpg',
                'image/png': 'png',
                'image/gif': 'gif',
                'image/svg+xml': 'svg',
                'audio/mpeg': 'mp3',
                'video/mp4': 'mp4',
                'application/zip': 'zip',
                'application/x-rar': 'rar'
            };
            
            return mimeMap[mimeType] || 'bin';
        }

        // 格式化文件大小
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        // 显示提示消息
        function showAlert(message, type = 'info') {
            const alertElement = $('#alertMessage');
            
            // 清除之前的定时器（如果存在）
            const existingTimer = alertElement.data('hideTimer');
            if (existingTimer) {
                clearTimeout(existingTimer);
            }
            
            alertElement
                .removeClass()
                .addClass(`alert alert-${type}`)
                .text(message)
                .show();

            // 10秒后自动隐藏，并保存定时器ID
            const hideTimer = setTimeout(() => {
                alertElement.hide();
                alertElement.removeData('hideTimer');
            }, 10000);
            
            alertElement.data('hideTimer', hideTimer);
        }

        // 初始化工具提示
        function initializeTooltips() {
            if (typeof bootstrap !== 'undefined' && bootstrap.Tooltip) {
                const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl);
                });
            }
        }

        // 设置事件监听器
        function setupFileEventListeners() {
            // 输出格式变化监听
            $('#outputFormat').on('change', function() {
                fileSettings.outputFormat = $(this).val();
                saveFileSettings();
                if (currentFileData) {
                    generateOutput();
                }
            });

            // 设置项变化监听
            $('#autoCopyResult, #rememberOutputFormat, #preserveFileData').on('change', function() {
                saveFileSettings();
            });
        }
    </script>

    <style>
        html,
        body {
            background: rgb(245 246 255);
            min-width: 100%;
            min-height: 100%;
            margin: 0;
            padding: 0;
        }

        /* 文件上传区域样式 */
        .file-display-area {
            background: #fff !important;
            border-radius: 10px !important;
            box-shadow: 0 2px 8px 0 rgba(96, 114, 252, .05) !important;
            padding: 12px !important;
            min-height: 300px !important;
            height: 50vh;
            width: 100%;
            border: 1px solid #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-display-area:hover {
            border-color: #86b7fe;
            box-shadow: 0 0 0 1px rgba(13, 110, 253, 0.1);
        }

        .file-display-area.dragover {
            border-color: #0d6efd;
            background-color: #cfe2ff !important;
            transform: scale(1.02);
        }

        .upload-content {
            pointer-events: none;
            text-align: center;
        }

        /* 文件预览样式 */
        .file-preview {
            text-align: center;
            pointer-events: none;
        }

        .file-details {
            max-width: 100%;
            word-break: break-all;
        }

        /* 强化textarea样式，确保能够调整大小和自动换行 */
        .code-input {
            background: #fff !important;
            border-radius: 10px !important;
            box-shadow: 0 2px 8px 0 rgba(96, 114, 252, .05) !important;
            padding: 12px !important;
            min-height: 300px !important;
            height: 50vh;
            width: 100%;
            border: 1px solid #fff;
            resize: vertical !important;
            /* 强制自动换行设置 */
            white-space: pre-wrap !important;
            word-wrap: break-word !important;
            word-break: break-all !important;
            overflow-wrap: break-word !important;
            /* 确保有滚动条 */
            overflow-y: auto !important;
            font-family: monospace;
            font-size: 0.875rem;
        }

        /* 鼠标悬浮时的提示效果 */
        .code-input:hover {
            border-color: #86b7fe;
            box-shadow: 0 0 0 1px rgba(13, 110, 253, 0.1);
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        /* 移动端布局优化 - 上下排列和按钮位置调整 */
        @media (max-width: 768px) {
            /* 确保row容器支持flexbox order */
            .textarea-container {
                display: flex !important;
                flex-direction: column !important;
            }

            /* 移动端输入框上下排列 */
            .textarea-container .input-section,
            .textarea-container .output-section {
                flex: 0 0 100% !important;
                max-width: 100% !important;
                margin-bottom: 20px;
            }

            /* 移动端输入框高度调整 */
            .code-input,
            .file-display-area {
                min-height: 200px !important;
                height: 40vh !important;
            }

            /* 移动端显示中间按钮，隐藏桌面按钮 */
            .mobile-buttons {
                display: block !important;
                order: 2;
                /* 确保在输入框和输出框之间 */
            }

            .desktop-buttons {
                display: none !important;
            }

            /* 调整输入框顺序 */
            .input-section {
                order: 1;
            }

            .output-section {
                order: 3;
            }

            /* 移动端按钮样式优化 */
            .mobile-buttons .btn {
                font-size: 14px;
                padding: 10px 15px;
                margin: 0 5px;
            }

            /* 移动端按钮容器样式 */
            .mobile-buttons {
                padding: 15px 0;
                background: rgba(245, 246, 255, 0.5);
                border-radius: 10px;
                margin: 15px 0;
            }
        }

        /* 桌面端隐藏移动端按钮 */
        @media (min-width: 769px) {
            .mobile-buttons {
                display: none !important;
            }

            .desktop-buttons {
                display: block !important;
            }

            .desktop-buttons .btn {
                height: 38px; /* 统一按钮高度 */
            }
        }

        div {
            box-sizing: border-box;
        }

        /* 设置区域样式优化 */
        .d-flex.flex-wrap.gap-3 {
            gap: 1rem !important;
        }

        /* 表单控件样式优化 */
        .form-control,
        .form-select,
        .form-range {
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .form-control:focus,
        .form-select:focus {
            border-color: #86b7fe;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        }

        /* 开关样式优化 */
        .form-check-input[type="checkbox"] {
            cursor: pointer;
        }

        /* 小标签样式 */
        .form-label.small {
            font-weight: 500;
            color: #6c757d;
            margin-bottom: 0.25rem;
        }

        /* 格式化输出卡片样式 */
        .card {
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-radius: 10px;
        }

        .card-header {
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            border-radius: 10px 10px 0 0 !important;
        }

        /* 按钮组样式 */
        .clear-btn,
        .copy-btn {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid #dee2e6;
            border-radius: 4px;
            color: #6c757d;
        }

        .clear-btn:hover,
        .copy-btn:hover {
            background: rgba(255, 255, 255, 1);
            color: #495057;
        }

        /* 介绍栏样式 */
        .intro-section {
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 15px;
        }

        /* 文件下载区域样式 */
        .file-download-content {
            padding: 30px 20px;
        }

        .file-info h6 {
            font-weight: 600;
            word-break: break-all;
        }

        .download-buttons .btn {
            transition: all 0.3s ease;
        }

        .download-buttons .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        /* 移动端介绍栏调整 */
        @media (max-width: 768px) {
            .intro-section .d-flex {
                flex-direction: column !important;
                align-items: flex-start !important;
            }
            
            .intro-section h1 {
                margin-bottom: 5px !important;
                font-size: 1.2rem !important;
            }
            
            .intro-section h2 {
                font-size: 0.9rem !important;
            }
        }
    </style>
</body>

</html>
